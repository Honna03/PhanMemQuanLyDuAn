<UserControl x:Class="QuanLyDuAn.Controls.ProjectsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    <Grid>
        <!-- Định nghĩa hàng: 1 hàng cho bộ lọc, 1 hàng cho DataGrid + PieChart, 1 hàng cho phân trang -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Bộ lọc -->
            <RowDefinition Height="*"/>
            <!-- DataGrid + PieChart -->
            <RowDefinition Height="Auto"/>
            <!-- Phân trang -->
        </Grid.RowDefinitions>

        <!-- Hàng 1: Bộ lọc và tìm kiếm -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10">
            <ComboBox x:Name="StatusFilterComboBox" 
                      Width="150" Height="30" 
                      DisplayMemberPath="TtTen" SelectedValuePath="TtMa"
                      SelectionChanged="StatusFilterComboBox_SelectionChanged"
                      Margin="0,0,10,0"/>
            <ComboBox x:Name="CreatorFilterComboBox" 
                      Width="150" Height="30" 
                      DisplayMemberPath="Name" SelectedValuePath="NvId"
                      SelectionChanged="CreatorFilterComboBox_SelectionChanged"
                      Margin="0,0,10,0"/>
            <TextBox x:Name="SearchTextBox" 
                     Width="200" Height="30" 
                     Text="Tìm kiếm..." 
                     TextChanged="SearchTextBox_TextChanged"
                     Margin="0,0,10,0"/>
            <Button x:Name="RefreshButton" 
                    Content="Làm mới" 
                    Width="100" Height="30" 
                    Click="RefreshButton_Click"/>
        </StackPanel>

        <!-- Hàng 2: DataGrid và PieChart -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <!-- DataGrid chiếm 2/3 -->
                <ColumnDefinition Width="1*"/>
                <!-- PieChart chiếm 1/3 -->
            </Grid.ColumnDefinitions>

            <!-- DataGrid -->
            <DataGrid x:Name="ProjectsDataGrid" 
                      Grid.Column="0" 
                      AutoGenerateColumns="False" 
                      IsReadOnly="True" 
                      Margin="10"
                      SelectionChanged="ProjectsDataGrid_SelectionChanged">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Tên dự án" Binding="{Binding DaTen}" Width="*"/>
                    <DataGridTextColumn Header="Trạng thái" Binding="{Binding TtMaNavigation.TtTen}" Width="100"/>
                    <DataGridTextColumn Header="Người tạo" Binding="{Binding NvIdNguoiTaoNavigation.NvTen}" Width="100"/>
                    <DataGridTextColumn Header="Ngày bắt đầu" Binding="{Binding DaBatDau, StringFormat={}{0:dd/MM/yyyy}}" Width="120"/>
                    <DataGridTextColumn Header="Ngày kết thúc" Binding="{Binding DaKetThuc, StringFormat={}{0:dd/MM/yyyy}}" Width="120"/>
                    <DataGridTextColumn Header="Tiến độ" Binding="{Binding DaTienDo, StringFormat={}{0}%}" Width="80"/>
                    <DataGridTemplateColumn Header="Hành động" Width="200">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Button x:Name="ViewDetailsButton" 
                                            Content="Xem" 
                                            Margin="2" 
                                            Tag="{Binding DaId}" 
                                            Click="ViewDetailsButton_Click"/>
                                    <Button x:Name="EditProjectButton" 
                                            Content="Sửa" 
                                            Margin="2" 
                                            Tag="{Binding DaId}" 
                                            Click="EditProjectButton_Click"/>
                                    <Button x:Name="DeleteProjectButton" 
                                            Content="Xóa" 
                                            Margin="2" 
                                            Tag="{Binding DaId}" 
                                            Click="DeleteProjectButton_Click"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <!-- PieChart -->
            <lvc:PieChart x:Name="StatusPieChart" 
                          Grid.Column="1" 
                          Margin="10" 
                          LegendLocation="Bottom" 
                          InnerRadius="30" 
                          Hoverable="True"/>
        </Grid>

        <!-- Hàng 3: Phân trang -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="10">
            <Button x:Name="PreviousPageButton" 
                    Content="Trang trước" 
                    Width="100" Height="30" 
                    Click="PreviousPageButton_Click"
                    Margin="0,0,10,0"/>
            <TextBlock x:Name="PageInfoTextBlock" 
                       VerticalAlignment="Center" 
                       Margin="10,0"/>
            <Button x:Name="NextPageButton" 
                    Content="Trang sau" 
                    Width="100" Height="30" 
                    Click="NextPageButton_Click"
                    Margin="10,0,0,0"/>
        </StackPanel>

        <!-- OverlayGrid cho form thêm/chỉnh sửa -->
        <Grid x:Name="OverlayGrid" 
              Grid.Row="0" Grid.RowSpan="3" 
              Background="Black" Opacity="0.5" 
              Visibility="Collapsed">
            <Grid Background="White" 
                  Width="400" Height="300" 
                  HorizontalAlignment="Center" VerticalAlignment="Center">
                <ContentControl x:Name="EditContentControl"/>
                <Button Content="Đóng" 
                        Width="80" Height="30" 
                        HorizontalAlignment="Right" VerticalAlignment="Bottom" 
                        Margin="10" 
                        Click="CloseOverlayButton_Click"/>
            </Grid>
        </Grid>
    </Grid>
</UserControl>
