<UserControl x:Class="QuanLyDuAn.Controls.ProjectsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:lc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             mc:Ignorable="d">
    <UserControl.Resources>
        <!-- Định nghĩa màu sắc kiểu bánh pizza -->
        <SolidColorBrush x:Key="PrimaryColor" Color="#FF4776E6"/>
        <!-- Màu chính cho nút -->
        <SolidColorBrush x:Key="SecondaryColor" Color="#FF8E54E9"/>
        <!-- Màu hover cho nút -->
        <SolidColorBrush x:Key="CompletedColor" Color="#FFE63946"/>
        <!-- Đỏ cà chua, giống pepperoni -->
        <SolidColorBrush x:Key="RemainingColor" Color="#FF06D6A0"/>
        <!-- Xanh lá, giống ớt chuông -->
        <SolidColorBrush x:Key="NotStartedColor" Color="#FFFFD60A"/>
        <!-- Vàng, giống phô mai -->
        <SolidColorBrush x:Key="DeleteButtonColor" Color="#FFE57373"/>
        <SolidColorBrush x:Key="DetailsButtonColor" Color="#FF81C784"/>

        <!-- Style cho Button -->
        <Style TargetType="Button">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Background" Value="{StaticResource PrimaryColor}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="5">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource SecondaryColor}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#FF3B2D7A"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Style riêng cho nút phân trang -->
        <Style TargetType="Button" x:Key="PagingButtonStyle">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="8,3"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Background" Value="{StaticResource PrimaryColor}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource SecondaryColor}"/>
                                <Setter TargetName="border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="Gray" ShadowDepth="1" BlurRadius="3" Opacity="0.5"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#FF3B2D7A"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Thanh điều khiển -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="15,10">
            <Button Content="Thêm dự án" Click="AddProjectButton_Click" Margin="0,0,10,0" Background="{StaticResource PrimaryColor}"/>
            <Button Content="Làm mới" Click="RefreshButton_Click" Background="{StaticResource PrimaryColor}"/>
        </StackPanel>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>

            <!-- DataGrid hiển thị danh sách dự án -->
            <DataGrid x:Name="ProjectsDataGrid" AutoGenerateColumns="False" IsReadOnly="True" SelectionChanged="ProjectsDataGrid_SelectionChanged" Margin="15,10">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Tên dự án" Binding="{Binding DaTen}" Width="*"/>
                    <DataGridTextColumn Header="Trạng thái" Binding="{Binding TtMaNavigation.TtTen, FallbackValue='N/A', TargetNullValue='N/A'}" Width="100"/>
                    <DataGridTextColumn Header="Người tạo" Binding="{Binding NvIdNguoiTaoNavigation.NvTen, FallbackValue='N/A', TargetNullValue='N/A'}" Width="150"/>
                    <DataGridTextColumn Header="Ngày bắt đầu" Binding="{Binding DaBatDau, StringFormat=dd/MM/yyyy, FallbackValue='N/A', TargetNullValue='N/A'}" Width="100"/>
                    <DataGridTextColumn Header="Ngày kết thúc" Binding="{Binding DaKetThuc, StringFormat=dd/MM/yyyy, FallbackValue='N/A', TargetNullValue='N/A'}" Width="100"/>
                    <DataGridTemplateColumn Header="Hành động" Width="200">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Button Content="Sửa" Tag="{Binding DaId}" Click="EditProject_Click" Margin="0,0,5,0" Background="{StaticResource PrimaryColor}" Padding="5,2"/>
                                    <Button Content="Xóa" Tag="{Binding DaId}" Click="DeleteProject_Click" Margin="0,0,5,0" Background="{StaticResource DeleteButtonColor}" Padding="5,2"/>
                                    <Button Content="Chi tiết" Tag="{Binding DaId}" Click="ViewDetails_Click" Background="{StaticResource DetailsButtonColor}" Padding="5,2"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <!-- Đường phân cách giữa DataGrid và PieChart -->
            <Separator Grid.Column="0" HorizontalAlignment="Right" Width="1" Background="#FFCCCCCC" Margin="0,10"/>

            <!-- Biểu đồ trạng thái công việc kiểu bánh pizza -->
            <StackPanel Grid.Column="1" Margin="15,10">
                <TextBlock Text="Trạng thái công việc" FontSize="18" FontWeight="Bold" Foreground="{StaticResource SecondaryColor}" Margin="0,0,0,15" HorizontalAlignment="Center"/>
                <Border CornerRadius="180" Margin="0,0,0,15">
                    <lc:PieChart x:Name="StatusChart" Width="380" Height="380" Margin="0" InnerRadius="120" LegendLocation="Bottom" Hoverable="True" HoverPushOut="20">
                        <lc:PieChart.Series>
                            <lc:PieSeries x:Name="CompletedSeries" Title="Hoàn thành" Fill="{StaticResource CompletedColor}" Stroke="Transparent" StrokeThickness="0" DataLabels="True" PushOut="12" FontSize="18" Foreground="#FF222222">
                                <lc:PieSeries.Effect>
                                    <DropShadowEffect ShadowDepth="6" BlurRadius="12" Opacity="0.6"/>
                                </lc:PieSeries.Effect>
                            </lc:PieSeries>
                            <lc:PieSeries x:Name="RemainingSeries" Title="Đang thực hiện" Fill="{StaticResource RemainingColor}" Stroke="Transparent" StrokeThickness="0" DataLabels="True" PushOut="12" FontSize="18" Foreground="#FF222222">
                                <lc:PieSeries.Effect>
                                    <DropShadowEffect ShadowDepth="6" BlurRadius="12" Opacity="0.6"/>
                                </lc:PieSeries.Effect>
                            </lc:PieSeries>
                            <lc:PieSeries x:Name="NotStartedSeries" Title="Chưa thực hiện" Fill="{StaticResource NotStartedColor}" Stroke="Transparent" StrokeThickness="0" DataLabels="True" PushOut="12" FontSize="18" Foreground="#FF222222">
                                <lc:PieSeries.Effect>
                                    <DropShadowEffect ShadowDepth="6" BlurRadius="12" Opacity="0.6"/>
                                </lc:PieSeries.Effect>
                            </lc:PieSeries>
                        </lc:PieChart.Series>
                        <lc:PieChart.DataTooltip>
                            <lc:DefaultTooltip Background="#FF2D3436" Foreground="White" FontSize="18" FontWeight="Bold" CornerRadius="5" Padding="12"/>
                        </lc:PieChart.DataTooltip>
                    </lc:PieChart>
                </Border>

                <!-- Phân trang -->
                <Border BorderBrush="#FFCCCCCC" BorderThickness="1" CornerRadius="5" Padding="10" Margin="0,0,0,10">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <Button Content="Trước" Click="PreviousPageButton_Click" Margin="0,0,10,0" Style="{StaticResource PagingButtonStyle}"/>
                        <TextBlock x:Name="PagingInfoTextBlock" VerticalAlignment="Center" Margin="0,0,10,0" FontSize="14" FontWeight="Medium" Foreground="#FF333333"/>
                        <Button Content="Sau" Click="NextPageButton_Click" Style="{StaticResource PagingButtonStyle}"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>

        <!-- Lớp phủ khi thêm/sửa dự án -->
        <Grid x:Name="OverlayGrid" Background="#80000000" Visibility="Collapsed"/>
    </Grid>
</UserControl>